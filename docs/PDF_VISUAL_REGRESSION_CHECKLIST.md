# PDF Visual Regression Checklist

**Purpose**: Ensure PDF rendering quality after code changes to prevent visual regressions.

**When to use**: After migrating PDF renderers, updating shared components, or modifying PDF generation logic.

---

## üîç General Verification (All Document Types)

- [ ] **Build passes**: `pnpm lint && pnpm build` completes without errors
- [ ] **No console errors**: Server logs show no PDF rendering exceptions
- [ ] **Fonts load correctly**: Inter font family renders properly (not fallback to Helvetica)
- [ ] **Page numbers accurate**: Footer page numbers match actual page count
- [ ] **No blank pages**: No unexpected empty pages between sections
- [ ] **Images display**: All photos and logos render correctly (no broken images)
- [ ] **Spacing consistent**: Margins, padding, and line heights match design system
- [ ] **Colors accurate**: Theme colors (blue/orange/red) render correctly
- [ ] **No orphaned headers**: Section headers always have at least 2 lines of content below

---

## üìÑ Main Report PDF (generateReportPDF.tsx)

### Cover Page

- [ ] Company logo renders (if provided)
- [ ] Company name displays in blue (#147BFF)
- [ ] License number, phone, email, website show correctly
- [ ] Hero image displays (if provided)
- [ ] Report title: "UNIVERSAL CLAIMS REPORT" (centered, bold)
- [ ] Client information complete (client name, property address, claim #, dates)
- [ ] QR code renders (if portal URL provided)
- [ ] QR code label: "Scan for Live Portal"

### Section 1: Executive Summary (Page 2)

- [ ] Section header: "1. EXECUTIVE SUMMARY" (blue, uppercase)
- [ ] Storm Event field displays
- [ ] Roof Condition field displays
- [ ] Conclusion field displays
- [ ] Footer shows company name and phone
- [ ] Page number: "Page 2"

### Section 2: Damage Summary (Page 3)

- [ ] Section header: "2. DAMAGE SUMMARY"
- [ ] Functional Damage field displays
- [ ] Manufacturer Issues field displays
- [ ] Code Violations field displays
- [ ] Safety Hazards field displays

### Section 3: Damage Photo Documentation (Page 4+)

- [ ] Section header: "3. DAMAGE PHOTO DOCUMENTATION"
- [ ] Photos render in 2-column grid layout
- [ ] 4 photos per page (2 rows √ó 2 columns)
- [ ] Photo captions display below each image
- [ ] Code citations display in blue italics below captions
- [ ] Photos are not stretched/distorted (maintain aspect ratio)
- [ ] Last page handles odd number of photos correctly (empty right column)

### Section 5: Weather Verification

- [ ] Weather data table renders correctly
- [ ] Table has 3 columns: Date of Loss, Hail Size, Wind Speed
- [ ] NOAA Storm Reports display as bullet list
- [ ] Proximity Analysis text displays
- [ ] Radar Imagery URLs display (if provided)

### Section 6: Code Compliance Analysis

- [ ] Each code item displays:
  - Code citation in blue
  - Requirement field
  - Observed field
  - Status (FAILED items show in red with correction text)

### Section 7: System Failure Analysis

- [ ] All 7 subsections display:
  - Roof Deck
  - Underlayment
  - Flashing
  - Shingles/Surface Material
  - Ventilation
  - Drainage
  - Ancillary Components

### Section 8: Scope of Work

- [ ] Table renders with 3 columns: Item, Quantity, Unit
- [ ] All scope items display correctly
- [ ] Table rows have proper borders

### Section 9: Professional Opinion

- [ ] All 7 opinion fields display:
  - Storm Causation
  - Functional Impairment
  - Code Violation Impact
  - Safety Hazard Assessment
  - Weathering Contribution
  - Pre-existing Damage
  - Recommendation

### Section 10: Signatures & Certifications

- [ ] Inspector signature image renders (if provided)
- [ ] Inspector name displays
- [ ] Inspector title displays
- [ ] Date displays
- [ ] Disclaimer text displays in smaller gray font

---

## üìã Supplement PDF (supplementRenderer.tsx)

### Cover Page

- [ ] Company logo renders (if provided)
- [ ] Orange badge: "SUPPLEMENT REQUEST" (white text on orange background)
- [ ] Supplement name displays (bold, centered)
- [ ] Subtitle: "Scope Variance Analysis"
- [ ] Info box displays with orange background (#fff7ed):
  - Property address
  - Loss date
  - Loss type
  - Generated date
  - Total delta (formatted as currency)
  - Organization name
- [ ] Footer: "Generated by SkaiScraper Report Intelligence" + "Page 1"

### Variance Table Page (Page 2)

- [ ] Section title: "Scope Variances" (orange theme)
- [ ] Table renders with 5 columns:
  - Description (30% width)
  - Type (15% width)
  - Adjuster (20% width)
  - Contractor (20% width)
  - Delta (15% width)
- [ ] Table header has orange background (#fed7aa)
- [ ] Long descriptions truncate with "..." (max 40 chars)
- [ ] Currency values format correctly ($X,XXX.XX)
- [ ] "N/A" displays when adjuster/contractor data missing
- [ ] Summary box displays with orange left border:
  - Total Variances count
  - Total Delta (formatted as currency)

### Section Pages (Page 3+)

- [ ] Each custom section displays:
  - Section title (orange, uppercase)
  - Section content (justified text)

### Evidence Page (if provided)

- [ ] Section title: "Evidence Photos" (orange)
- [ ] Photo count displays: "X photo(s) attached"
- [ ] Photos render in 2-column grid
- [ ] Photo captions display (title or original filename)
- [ ] Odd number of photos handled correctly

### Weather Verification Page (if provided)

- [ ] Weather data displays in table format
- [ ] Source label shows provider name
- [ ] All weather metrics render correctly

---

## üìù Rebuttal PDF (rebuttalRenderer.tsx)

### Cover Page

- [ ] Company logo renders (if provided)
- [ ] Red badge: "REBUTTAL LETTER" (white text on red background)
- [ ] Rebuttal name displays (bold, centered)
- [ ] Subtitle: "Claim Denial Response"
- [ ] Info box displays with red background (#fef2f2):
  - Property address
  - Loss date
  - Loss type
  - Policy number (if provided)
  - Carrier name
  - Generated date
  - Organization name
- [ ] Footer: "Generated by SkaiScraper Report Intelligence" + "Page 1"

### Letter Page (Page 2)

- [ ] Letterhead displays:
  - Company logo (if provided)
  - Organization name (bold)
  - Address, phone, email (if provided in orgContactInfo)
  - Red bottom border
- [ ] Date displays (formatted: "Month DD, YYYY")
- [ ] Recipient block displays:
  - Carrier name
  - Adjuster name (if provided): "Attn: [Name]"
  - "Claims Department"
- [ ] Subject line box displays with red left border:
  - "RE:" label (red, bold)
  - "Rebuttal - [Loss Type] Loss at [Property Address]"
  - Policy number (if provided)
- [ ] First 2 sections display:
  - Section titles (red, uppercase)
  - Section content (justified text)
  - Bullet lists render if content contains line breaks with "-"

### Continuation Pages (Page 3+)

- [ ] Remaining sections display with red theme
- [ ] Last section includes signature block:
  - "Respectfully submitted,"
  - Organization name (bold)
  - "Claims Advocacy Team"

### Attachments Page (if provided)

- [ ] "Attachments" heading displays (red theme)
- [ ] Attachments display as numbered list
- [ ] Red left border on attachment box

### Evidence Page (if provided)

- [ ] Section title: "Evidence Photos" (red)
- [ ] Photo count displays: "X photo(s) attached"
- [ ] Photos render in 2-column grid
- [ ] Photo captions display (title or original filename)

### Weather Verification Page (if provided)

- [ ] Weather data displays in table format
- [ ] Source label shows provider name

---

## üîß Manual Testing Workflow

### 1. Generate Test PDFs

```bash
# Start dev server
pnpm dev

# Navigate to claim workspace and trigger PDF generation:
# - Main Report: /claims/[claimId]/reports
# - Supplement: /claims/[claimId]/supplements
# - Rebuttal: /claims/[claimId]/rebuttals

# Download all 3 PDF types
```

### 2. Visual Inspection

1. **Open PDFs in Adobe Acrobat or Preview**
2. **Check each page sequentially** against checklist above
3. **Compare with previous version** (if available) for regressions
4. **Verify on different devices**:
   - Desktop PDF viewer
   - Mobile PDF viewer (iOS/Android)
   - Print preview

### 3. Automated Checks (Future Enhancement)

```bash
# TODO: Implement visual regression tests using:
# - Playwright PDF snapshots
# - PDF.js for programmatic validation
# - Image comparison for layout verification
```

---

## üö® Common Issues & Fixes

### Issue: Blank pages between sections

**Cause**: Page break logic inserting unnecessary page
**Fix**: Check `minPresenceAhead` and `breakAfter` properties in baseStyles

### Issue: Orphaned headers (header at bottom of page)

**Cause**: Section header not keeping content together
**Fix**: Verify `breakAfter: false` on section headers + `minPresenceAhead: 2`

### Issue: Photos stretched/distorted

**Cause**: `objectFit` not set or incorrect dimensions
**Fix**: Use `objectFit: "cover"` and fixed height in photoGridStyles

### Issue: Table rows split across pages

**Cause**: Missing `minPresenceAhead` on table rows
**Fix**: Add `minPresenceAhead: 1` to tableRow style

### Issue: Wrong theme colors (e.g., blue instead of orange)

**Cause**: Hardcoded colors instead of using theme
**Fix**: Use `colors.supplement`, `colors.rebuttal`, or `colors.proposal` from pdfConfig

### Issue: Missing fonts (fallback to Helvetica)

**Cause**: Font registration failed or network issue loading fonts
**Fix**: Verify Font.register() at top of file + check network tab for font loading

### Issue: Page numbers incorrect

**Cause**: Hardcoded page numbers instead of calculating
**Fix**: Pass `pageNumber` prop dynamically to PDFPage component

---

## ‚úÖ Sign-Off

**Migration Date**: December 16, 2025
**Migrated By**: AI Agent (Session 3, COMMIT D)
**Files Migrated**:

- `src/lib/pdf/generateReportPDF.tsx` ‚úÖ
- `src/lib/pdf/supplementRenderer.tsx` ‚úÖ
- `src/lib/pdf/rebuttalRenderer.tsx` ‚úÖ

**Verification Status**:

- [ ] Main Report PDF verified
- [ ] Supplement PDF verified
- [ ] Rebuttal PDF verified
- [ ] All checklist items passed
- [ ] Production deployment approved

**Notes**:
_Add any specific issues encountered or workarounds applied during verification._

---

**Last Updated**: December 16, 2025
