# ============================================================================
# H-20: Lighthouse CI Configuration
# ============================================================================

ci:
  collect:
    numberOfRuns: 3
    startServerCommand: "pnpm build && pnpm start"
    startServerReadyPattern: "ready on"
    url:
      - "http://localhost:3000/"
      - "http://localhost:3000/dashboard"
      - "http://localhost:3000/claims"
      - "http://localhost:3000/settings/billing"
      - "http://localhost:3000/marketplace"

  assert:
    preset: "lighthouse:recommended"
    assertions:
      # Performance
      first-contentful-paint:
        - error
        - maxNumericValue: 2000
      largest-contentful-paint:
        - error
        - maxNumericValue: 3000
      cumulative-layout-shift:
        - error
        - maxNumericValue: 0.1
      total-blocking-time:
        - error
        - maxNumericValue: 300
      speed-index:
        - error
        - maxNumericValue: 4000

      # Best Practices
      uses-http2: "error"
      uses-passive-event-listeners: "error"
      no-document-write: "error"

      # Accessibility
      color-contrast: "error"
      image-alt: "error"
      label: "error"

      # SEO
      meta-description: "error"
      document-title: "error"

      # Target Scores
      categories:performance:
        - error
        - minScore: 0.9
      categories:accessibility:
        - error
        - minScore: 0.9
      categories:best-practices:
        - error
        - minScore: 0.9
      categories:seo:
        - error
        - minScore: 0.9

  upload:
    target: "temporary-public-storage"

  server:
    port: 9001
    storage:
      sqlDatabasePath: ".lighthouseci/lhci.db"
