<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900" font-family="Arial, Helvetica, sans-serif">
  <defs>
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#1e3a5f;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2d5f8a;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="aiGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#7c3aed;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#a855f7;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="dataGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#059669;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#10b981;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="apiGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#d97706;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#f59e0b;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-5%" y="-5%" width="110%" height="110%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.15"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="1200" height="900" fill="#f8fafc" rx="8"/>

  <!-- Title -->
  <rect x="0" y="0" width="1200" height="60" fill="url(#headerGrad)"/>
  <text x="600" y="38" text-anchor="middle" fill="white" font-size="22" font-weight="bold">Fig. 1 — SkaiScraper System Architecture (Patent Reference)</text>
  <text x="1180" y="38" text-anchor="end" fill="#94a3b8" font-size="11">ClearSkai Technologies LLC © 2026</text>

  <!-- Layer 1: Client Layer -->
  <rect x="40" y="80" width="1120" height="100" rx="8" fill="white" stroke="#3b82f6" stroke-width="2" filter="url(#shadow)"/>
  <text x="60" y="105" fill="#3b82f6" font-size="14" font-weight="bold">CLIENT LAYER</text>

  <rect x="60" y="115" width="200" height="50" rx="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="1"/>
  <text x="160" y="137" text-anchor="middle" fill="#1e40af" font-size="12" font-weight="bold">Pro Portal</text>
  <text x="160" y="153" text-anchor="middle" fill="#1e40af" font-size="10">(Contractor Dashboard)</text>

  <rect x="280" y="115" width="200" height="50" rx="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="1"/>
  <text x="380" y="137" text-anchor="middle" fill="#1e40af" font-size="12" font-weight="bold">Client Portal</text>
  <text x="380" y="153" text-anchor="middle" fill="#1e40af" font-size="10">(Homeowner Interface)</text>

  <rect x="500" y="115" width="200" height="50" rx="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="1"/>
  <text x="600" y="137" text-anchor="middle" fill="#1e40af" font-size="12" font-weight="bold">Trades Network</text>
  <text x="600" y="153" text-anchor="middle" fill="#1e40af" font-size="10">(Professional Marketplace)</text>

  <rect x="720" y="115" width="200" height="50" rx="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="1"/>
  <text x="820" y="137" text-anchor="middle" fill="#1e40af" font-size="12" font-weight="bold">Admin Portal</text>
  <text x="820" y="153" text-anchor="middle" fill="#1e40af" font-size="10">(System Management)</text>

  <rect x="940" y="115" width="200" height="50" rx="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="1"/>
  <text x="1040" y="137" text-anchor="middle" fill="#1e40af" font-size="12" font-weight="bold">Public Site</text>
  <text x="1040" y="153" text-anchor="middle" fill="#1e40af" font-size="10">(Marketing + Onboarding)</text>

  <!-- Arrow down -->
  <line x1="600" y1="180" x2="600" y2="200" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead)"/>
  <defs><marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/></marker></defs>

  <!-- Layer 2: Middleware -->
  <rect x="40" y="200" width="1120" height="55" rx="8" fill="white" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
  <text x="60" y="225" fill="#d97706" font-size="14" font-weight="bold">MIDDLEWARE — Identity-Based Routing</text>
  <text x="60" y="243" fill="#92400e" font-size="11">Clerk Auth → Session Claims → userType Detection → Surface Routing (Pro→Dashboard, Client→Portal) → Rate Limiting (Upstash Redis)</text>

  <!-- Arrow down -->
  <line x1="600" y1="255" x2="600" y2="275" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Layer 3: API Layer -->
  <rect x="40" y="275" width="1120" height="110" rx="8" fill="white" stroke="url(#apiGrad)" stroke-width="2" filter="url(#shadow)"/>
  <text x="60" y="300" fill="#d97706" font-size="14" font-weight="bold">API LAYER — 1,073+ Server Routes</text>

  <rect x="60" y="310" width="130" height="60" rx="4" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
  <text x="125" y="332" text-anchor="middle" fill="#92400e" font-size="10" font-weight="bold">/api/ai/*</text>
  <text x="125" y="346" text-anchor="middle" fill="#92400e" font-size="9">40+ AI Endpoints</text>
  <text x="125" y="358" text-anchor="middle" fill="#92400e" font-size="9">Vision, Weather, Reports</text>

  <rect x="200" y="310" width="130" height="60" rx="4" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
  <text x="265" y="332" text-anchor="middle" fill="#92400e" font-size="10" font-weight="bold">/api/claims/*</text>
  <text x="265" y="346" text-anchor="middle" fill="#92400e" font-size="9">CRUD + Workflow</text>
  <text x="265" y="358" text-anchor="middle" fill="#92400e" font-size="9">State Machine</text>

  <rect x="340" y="310" width="130" height="60" rx="4" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
  <text x="405" y="332" text-anchor="middle" fill="#92400e" font-size="10" font-weight="bold">/api/reports/*</text>
  <text x="405" y="346" text-anchor="middle" fill="#92400e" font-size="9">Generation + Export</text>
  <text x="405" y="358" text-anchor="middle" fill="#92400e" font-size="9">Templates + PDF</text>

  <rect x="480" y="310" width="130" height="60" rx="4" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
  <text x="545" y="332" text-anchor="middle" fill="#92400e" font-size="10" font-weight="bold">/api/weather/*</text>
  <text x="545" y="346" text-anchor="middle" fill="#92400e" font-size="9">DOL Verification</text>
  <text x="545" y="358" text-anchor="middle" fill="#92400e" font-size="9">Multi-Provider</text>

  <rect x="620" y="310" width="130" height="60" rx="4" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
  <text x="685" y="332" text-anchor="middle" fill="#92400e" font-size="10" font-weight="bold">/api/tokens/*</text>
  <text x="685" y="346" text-anchor="middle" fill="#92400e" font-size="9">Metering + Ledger</text>
  <text x="685" y="358" text-anchor="middle" fill="#92400e" font-size="9">Billing + Audit</text>

  <rect x="760" y="310" width="130" height="60" rx="4" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
  <text x="825" y="332" text-anchor="middle" fill="#92400e" font-size="10" font-weight="bold">/api/agents/*</text>
  <text x="825" y="346" text-anchor="middle" fill="#92400e" font-size="9">Mission Execution</text>
  <text x="825" y="358" text-anchor="middle" fill="#92400e" font-size="9">6 Agent Types</text>

  <rect x="900" y="310" width="130" height="60" rx="4" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
  <text x="965" y="332" text-anchor="middle" fill="#92400e" font-size="10" font-weight="bold">/api/trades/*</text>
  <text x="965" y="346" text-anchor="middle" fill="#92400e" font-size="9">50+ Endpoints</text>
  <text x="965" y="358" text-anchor="middle" fill="#92400e" font-size="9">Network + Jobs</text>

  <rect x="1040" y="310" width="100" height="60" rx="4" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
  <text x="1090" y="332" text-anchor="middle" fill="#92400e" font-size="10" font-weight="bold">/api/cron/*</text>
  <text x="1090" y="346" text-anchor="middle" fill="#92400e" font-size="9">8 Scheduled</text>
  <text x="1090" y="358" text-anchor="middle" fill="#92400e" font-size="9">Jobs</text>

  <!-- Arrow down -->
  <line x1="600" y1="385" x2="600" y2="405" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Layer 4: Intelligence Layer -->
  <rect x="40" y="405" width="1120" height="160" rx="8" fill="white" stroke="#7c3aed" stroke-width="2" filter="url(#shadow)"/>
  <text x="60" y="430" fill="#7c3aed" font-size="14" font-weight="bold">AI INTELLIGENCE LAYER — "The Brain" (orchestrateClaim)</text>

  <!-- Sub-boxes for AI components -->
  <rect x="60" y="440" width="150" height="50" rx="4" fill="#ede9fe" stroke="#7c3aed" stroke-width="1"/>
  <text x="135" y="460" text-anchor="middle" fill="#5b21b6" font-size="10" font-weight="bold">Rules Engine</text>
  <text x="135" y="475" text-anchor="middle" fill="#5b21b6" font-size="9">Custom DSL Evaluation</text>

  <rect x="220" y="440" width="150" height="50" rx="4" fill="#ede9fe" stroke="#7c3aed" stroke-width="1"/>
  <text x="295" y="460" text-anchor="middle" fill="#5b21b6" font-size="10" font-weight="bold">State Machine</text>
  <text x="295" y="475" text-anchor="middle" fill="#5b21b6" font-size="9">9-State Lifecycle</text>

  <rect x="380" y="440" width="150" height="50" rx="4" fill="#ede9fe" stroke="#7c3aed" stroke-width="1"/>
  <text x="455" y="460" text-anchor="middle" fill="#5b21b6" font-size="10" font-weight="bold">Similarity Engine</text>
  <text x="455" y="475" text-anchor="middle" fill="#5b21b6" font-size="9">3072-dim Vectors</text>

  <rect x="540" y="440" width="150" height="50" rx="4" fill="#ede9fe" stroke="#7c3aed" stroke-width="1"/>
  <text x="615" y="460" text-anchor="middle" fill="#5b21b6" font-size="10" font-weight="bold">Strategy Engine</text>
  <text x="615" y="475" text-anchor="middle" fill="#5b21b6" font-size="9">Carrier-Specific Tactics</text>

  <rect x="700" y="440" width="150" height="50" rx="4" fill="#ede9fe" stroke="#7c3aed" stroke-width="1"/>
  <text x="775" y="460" text-anchor="middle" fill="#5b21b6" font-size="10" font-weight="bold">Claim Planner</text>
  <text x="775" y="475" text-anchor="middle" fill="#5b21b6" font-size="9">Next-Action Suggestions</text>

  <rect x="860" y="440" width="150" height="50" rx="4" fill="#ede9fe" stroke="#7c3aed" stroke-width="1"/>
  <text x="935" y="460" text-anchor="middle" fill="#5b21b6" font-size="10" font-weight="bold">Feedback Loop</text>
  <text x="935" y="475" text-anchor="middle" fill="#5b21b6" font-size="9">Action→Outcome Learning</text>

  <rect x="1020" y="440" width="120" height="50" rx="4" fill="#ede9fe" stroke="#7c3aed" stroke-width="1"/>
  <text x="1080" y="460" text-anchor="middle" fill="#5b21b6" font-size="10" font-weight="bold">Explanations</text>
  <text x="1080" y="475" text-anchor="middle" fill="#5b21b6" font-size="9">Human-Readable</text>

  <!-- Agents Row -->
  <text x="60" y="510" fill="#7c3aed" font-size="12" font-weight="bold">Autonomous Agents:</text>
  <rect x="220" y="498" width="120" height="30" rx="4" fill="#c4b5fd" stroke="#7c3aed" stroke-width="1"/>
  <text x="280" y="517" text-anchor="middle" fill="#4c1d95" font-size="9">Bad Faith Detection</text>

  <rect x="350" y="498" width="120" height="30" rx="4" fill="#c4b5fd" stroke="#7c3aed" stroke-width="1"/>
  <text x="410" y="517" text-anchor="middle" fill="#4c1d95" font-size="9">Claims Analysis</text>

  <rect x="480" y="498" width="120" height="30" rx="4" fill="#c4b5fd" stroke="#7c3aed" stroke-width="1"/>
  <text x="540" y="517" text-anchor="middle" fill="#4c1d95" font-size="9">Rebuttal Builder</text>

  <rect x="610" y="498" width="120" height="30" rx="4" fill="#c4b5fd" stroke="#7c3aed" stroke-width="1"/>
  <text x="670" y="517" text-anchor="middle" fill="#4c1d95" font-size="9">Report Assembly</text>

  <rect x="740" y="498" width="120" height="30" rx="4" fill="#c4b5fd" stroke="#7c3aed" stroke-width="1"/>
  <text x="800" y="517" text-anchor="middle" fill="#4c1d95" font-size="9">Security Audit</text>

  <rect x="870" y="498" width="120" height="30" rx="4" fill="#c4b5fd" stroke="#7c3aed" stroke-width="1"/>
  <text x="930" y="517" text-anchor="middle" fill="#4c1d95" font-size="9">Token Ledger</text>

  <!-- Output box -->
  <rect x="60" y="535" width="1080" height="20" rx="4" fill="#faf5ff" stroke="#a855f7" stroke-width="1"/>
  <text x="600" y="549" text-anchor="middle" fill="#6b21a8" font-size="10" font-weight="bold">Output: ClaimIntelligence { approvalLikelihood, supplementSuccessProbability, riskScore, recommendedStrategy, nextActions }</text>

  <!-- Arrow down -->
  <line x1="600" y1="565" x2="600" y2="585" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Layer 5: External Services -->
  <rect x="40" y="585" width="540" height="130" rx="8" fill="white" stroke="#059669" stroke-width="2" filter="url(#shadow)"/>
  <text x="60" y="610" fill="#059669" font-size="14" font-weight="bold">EXTERNAL SERVICES</text>

  <rect x="60" y="620" width="100" height="40" rx="4" fill="#d1fae5" stroke="#059669" stroke-width="1"/>
  <text x="110" y="638" text-anchor="middle" fill="#065f46" font-size="9" font-weight="bold">OpenAI</text>
  <text x="110" y="650" text-anchor="middle" fill="#065f46" font-size="8">GPT-4o Vision</text>

  <rect x="170" y="620" width="100" height="40" rx="4" fill="#d1fae5" stroke="#059669" stroke-width="1"/>
  <text x="220" y="638" text-anchor="middle" fill="#065f46" font-size="9" font-weight="bold">Visual Crossing</text>
  <text x="220" y="650" text-anchor="middle" fill="#065f46" font-size="8">Weather Data</text>

  <rect x="280" y="620" width="100" height="40" rx="4" fill="#d1fae5" stroke="#059669" stroke-width="1"/>
  <text x="330" y="638" text-anchor="middle" fill="#065f46" font-size="9" font-weight="bold">Stripe</text>
  <text x="330" y="650" text-anchor="middle" fill="#065f46" font-size="8">Payments</text>

  <rect x="390" y="620" width="80" height="40" rx="4" fill="#d1fae5" stroke="#059669" stroke-width="1"/>
  <text x="430" y="638" text-anchor="middle" fill="#065f46" font-size="9" font-weight="bold">Clerk</text>
  <text x="430" y="650" text-anchor="middle" fill="#065f46" font-size="8">Auth</text>

  <rect x="480" y="620" width="80" height="40" rx="4" fill="#d1fae5" stroke="#059669" stroke-width="1"/>
  <text x="520" y="638" text-anchor="middle" fill="#065f46" font-size="9" font-weight="bold">Mapbox</text>
  <text x="520" y="650" text-anchor="middle" fill="#065f46" font-size="8">Maps</text>

  <rect x="60" y="668" width="100" height="35" rx="4" fill="#d1fae5" stroke="#059669" stroke-width="1"/>
  <text x="110" y="686" text-anchor="middle" fill="#065f46" font-size="9" font-weight="bold">Replicate</text>
  <text x="110" y="696" text-anchor="middle" fill="#065f46" font-size="8">Image Gen</text>

  <rect x="170" y="668" width="100" height="35" rx="4" fill="#d1fae5" stroke="#059669" stroke-width="1"/>
  <text x="220" y="686" text-anchor="middle" fill="#065f46" font-size="9" font-weight="bold">Resend</text>
  <text x="220" y="696" text-anchor="middle" fill="#065f46" font-size="8">Email</text>

  <rect x="280" y="668" width="100" height="35" rx="4" fill="#d1fae5" stroke="#059669" stroke-width="1"/>
  <text x="330" y="686" text-anchor="middle" fill="#065f46" font-size="9" font-weight="bold">Sentry</text>
  <text x="330" y="696" text-anchor="middle" fill="#065f46" font-size="8">Monitoring</text>

  <rect x="390" y="668" width="80" height="35" rx="4" fill="#d1fae5" stroke="#059669" stroke-width="1"/>
  <text x="430" y="686" text-anchor="middle" fill="#065f46" font-size="9" font-weight="bold">Twilio</text>
  <text x="430" y="696" text-anchor="middle" fill="#065f46" font-size="8">SMS</text>

  <rect x="480" y="668" width="80" height="35" rx="4" fill="#d1fae5" stroke="#059669" stroke-width="1"/>
  <text x="520" y="686" text-anchor="middle" fill="#065f46" font-size="9" font-weight="bold">NOAA</text>
  <text x="520" y="696" text-anchor="middle" fill="#065f46" font-size="8">Weather</text>

  <!-- Layer 5b: Data Layer -->
  <rect x="600" y="585" width="560" height="130" rx="8" fill="white" stroke="#dc2626" stroke-width="2" filter="url(#shadow)"/>
  <text x="620" y="610" fill="#dc2626" font-size="14" font-weight="bold">DATA LAYER</text>

  <rect x="620" y="620" width="160" height="40" rx="4" fill="#fee2e2" stroke="#dc2626" stroke-width="1"/>
  <text x="700" y="638" text-anchor="middle" fill="#991b1b" font-size="10" font-weight="bold">PostgreSQL</text>
  <text x="700" y="650" text-anchor="middle" fill="#991b1b" font-size="8">140+ Models via Prisma</text>

  <rect x="790" y="620" width="160" height="40" rx="4" fill="#fee2e2" stroke="#dc2626" stroke-width="1"/>
  <text x="870" y="638" text-anchor="middle" fill="#991b1b" font-size="10" font-weight="bold">Cloudflare R2</text>
  <text x="870" y="650" text-anchor="middle" fill="#991b1b" font-size="8">Object Storage + Signed URLs</text>

  <rect x="960" y="620" width="180" height="40" rx="4" fill="#fee2e2" stroke="#dc2626" stroke-width="1"/>
  <text x="1050" y="638" text-anchor="middle" fill="#991b1b" font-size="10" font-weight="bold">Upstash Redis</text>
  <text x="1050" y="650" text-anchor="middle" fill="#991b1b" font-size="8">Cache + Rate Limiting</text>

  <rect x="620" y="668" width="160" height="35" rx="4" fill="#fee2e2" stroke="#dc2626" stroke-width="1"/>
  <text x="700" y="686" text-anchor="middle" fill="#991b1b" font-size="10" font-weight="bold">Vector Store</text>
  <text x="700" y="696" text-anchor="middle" fill="#991b1b" font-size="8">3072-dim Embeddings</text>

  <rect x="790" y="668" width="160" height="35" rx="4" fill="#fee2e2" stroke="#dc2626" stroke-width="1"/>
  <text x="870" y="686" text-anchor="middle" fill="#991b1b" font-size="10" font-weight="bold">Supabase</text>
  <text x="870" y="696" text-anchor="middle" fill="#991b1b" font-size="8">Storage + Auth Helpers</text>

  <rect x="960" y="668" width="180" height="35" rx="4" fill="#fee2e2" stroke="#dc2626" stroke-width="1"/>
  <text x="1050" y="686" text-anchor="middle" fill="#991b1b" font-size="10" font-weight="bold">Token Ledger</text>
  <text x="1050" y="696" text-anchor="middle" fill="#991b1b" font-size="8">Append-Only + Signed</text>

  <!-- Footer -->
  <rect x="0" y="740" width="1200" height="160" fill="#1e293b" rx="0"/>
  <text x="60" y="768" fill="#94a3b8" font-size="14" font-weight="bold">PATENT CLAIM COVERAGE MAP</text>

  <text x="60" y="792" fill="#67e8f9" font-size="11">■ Claim 1 (Method):</text>
  <text x="200" y="792" fill="#e2e8f0" font-size="11">Photo Upload → Signed URL → Vision AI → Weather Verification → Token Deduction → Report Generation → Delivery</text>

  <text x="60" y="812" fill="#a78bfa" font-size="11">■ Claim 2 (System):</text>
  <text x="200" y="812" fill="#e2e8f0" font-size="11">Artifact Store + Worker Queue + Token Ledger + Vision Module + Weather Module + Report Engine + Automation Engine</text>

  <text x="60" y="832" fill="#34d399" font-size="11">■ Claim 4 (Orchestration):</text>
  <text x="230" y="832" fill="#e2e8f0" font-size="11">Rules Engine + State Machine + Similarity Search + Strategy Engine + Planner + Feedback Loop → ClaimIntelligence</text>

  <text x="60" y="852" fill="#fbbf24" font-size="11">■ Claim 5 (Compliance):</text>
  <text x="220" y="852" fill="#e2e8f0" font-size="11">Carrier Rules DB + Scope Adjustment + Supplement Generation + Code Citations</text>

  <text x="60" y="872" fill="#f87171" font-size="11">■ Claim 6 (Bad Faith):</text>
  <text x="210" y="872" fill="#e2e8f0" font-size="11">Timeline Analysis + Delay Detection + Contradiction ID + Risk Scoring + Legal Action Recommendation</text>

  <text x="600" y="892" text-anchor="middle" fill="#475569" font-size="10">SkaiScraper — ClearSkai Technologies LLC — Provisional Patent Reference Diagram — February 2026</text>
</svg>
